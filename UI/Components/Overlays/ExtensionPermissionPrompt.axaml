<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="using:MnemoApp.UI.Components.Overlays"
             x:Class="MnemoApp.UI.Components.Overlays.ExtensionPermissionPrompt"
             x:DataType="local:ExtensionPermissionPrompt"
             x:Name="Self">
  <Border Background="{DynamicResource OverlayBackgroundBrush}"
          BorderBrush="{DynamicResource IconsSeparationBarBrush}"
          BorderThickness="1"
          CornerRadius="12"
          Padding="24"
          MinWidth="480"
          MaxWidth="600">
    <Grid RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="16">
      <!-- Header -->
      <StackPanel Grid.Row="0" Spacing="8">
        <TextBlock Text="Extension Permission Request"
                   FontSize="{DynamicResource FontSize.Heading3}" 
                   FontFamily="{DynamicResource Font.Bold}"
                   Foreground="{DynamicResource TextPrimaryBrush}"
                   HorizontalAlignment="Center"/>
        <TextBlock Text="{Binding #Self.ExtensionInfo}"
                   FontFamily="{DynamicResource Font.Medium}"
                   FontSize="{DynamicResource FontSize.Body.Small}"
                   Foreground="{DynamicResource TextSecondaryBrush}"
                   HorizontalAlignment="Center"
                   TextWrapping="Wrap"/>
        <TextBlock Text="{Binding #Self.Description}"
                   FontFamily="{DynamicResource Font.Regular}"
                   FontSize="{DynamicResource FontSize.Body.ExtraSmall}"
                   Foreground="{DynamicResource TextTertiaryBrush}"
                   HorizontalAlignment="Center"
                   TextWrapping="Wrap"
                   Margin="0,8,0,0"/>
      </StackPanel>

      <!-- Permissions List -->
      <StackPanel Grid.Row="1" Spacing="12">
        <TextBlock Text="Requested Permissions:"
                   FontSize="{DynamicResource FontSize.Heading5}"
                   FontFamily="{DynamicResource Font.SemiBold}"
                   Foreground="{DynamicResource TextPrimaryBrush}"/>
        
        <ItemsControl ItemsSource="{Binding #Self.PermissionItems}">
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Border Background="{DynamicResource WidgetBackgroundSecondary}"
                      CornerRadius="8"
                      Padding="12"
                      Margin="0,0,0,8">
                <StackPanel Orientation="Horizontal" Spacing="12">
                  <ToggleButton Content="{Binding Name}"
                               IsChecked="{Binding IsGranted}"
                               FontSize="{DynamicResource FontSize.Body.Small}"
                               FontFamily="{DynamicResource Font.Medium}"
                               Classes="PermissionToggle"/>
                  <TextBlock Text="{Binding Description}"
                             FontSize="{DynamicResource FontSize.Body.ExtraSmall}"
                             Foreground="{DynamicResource TextSecondaryBrush}"
                             TextWrapping="Wrap"
                             VerticalAlignment="Center"
                             MaxWidth="300"/>
                </StackPanel>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </StackPanel>

      <!-- Buttons -->
      <StackPanel Grid.Row="2" 
                  Orientation="Horizontal" 
                  Spacing="12" 
                  HorizontalAlignment="Center"
                  Margin="0,8,0,0">
        <Button Content="Deny"
                Classes="Subtle"
                Command="{Binding #Self.DenyCommand}"
                MinWidth="100"/>
        <Button Content="Approve"
                Command="{Binding #Self.ApproveCommand}"
                MinWidth="100"/>
      </StackPanel>
    </Grid>
  </Border>
</UserControl>
