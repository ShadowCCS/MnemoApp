<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="using:MnemoApp.UI.Components.Overlays"
             xmlns:cmp="using:MnemoApp.UI.Components"
             xmlns:core="using:MnemoApp.Core.Services"
             xmlns:conv="using:MnemoApp.UI.Converters"
             x:Class="MnemoApp.UI.Components.Overlays.LanguageSelectOverlay"
             x:DataType="local:LanguageSelectOverlay">
  <UserControl.Resources>
    <conv:SelectedBrushConverter x:Key="SelectedBrushConverter"/>
  </UserControl.Resources>
  <UserControl.Styles>
    <Style Selector="Button:pointerover">
      <Setter Property="Background" Value="#11000000"/>
      <Setter Property="BorderBrush" Value="#22FFFFFF"/>
      <Setter Property="BorderThickness" Value="1"/>
    </Style>
  </UserControl.Styles>
  <Border Background="{DynamicResource WorkspaceBackgroundBrush}"
          BorderBrush="{DynamicResource IconsSeparationBarBrush}"
          BorderThickness="1"
          CornerRadius="12"
          Padding="16"
          MinWidth="650"
          MinHeight="400">
    <Grid>
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
        <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>
      
      <!-- Header -->
      <StackPanel Grid.Row="0" Margin="0,0,0,12" Spacing="12" Orientation="Horizontal" VerticalAlignment="Center">
        <ComboBox MinWidth="130" SelectedIndex="0">
          <ComboBoxItem Content="All"/>
          <ComboBoxItem Content="Last Used"/>
        </ComboBox>

        <TextBox Classes="searchBox" Width="360" Height="32" VerticalContentAlignment="Center" Padding="{DynamicResource SearchBarPadding}" Background="{DynamicResource SearchBarBackgroundBrush}" CornerRadius="{DynamicResource SearchBarCornerRadius}" Text="{Binding SearchQuery, Mode=TwoWay}" Watermark="Search languages..."/>

        <Button Content="Import" Command="{Binding ImportCommand}"/>
        <Button Content="Export" Command="{Binding ExportCommand}"/>
      </StackPanel>
      
      <!-- Main Area - Expand to fill available space -->
      <ScrollViewer Grid.Row="1" VerticalAlignment="Stretch">
        <ItemsControl ItemsSource="{Binding PagedLanguages}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <WrapPanel Margin="4" ItemWidth="140" ItemHeight="120"/>
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="core:LanguageManifest">
              <Border CornerRadius="10" Padding="6" Margin="6">
                <Border.Background>
                  <MultiBinding Converter="{StaticResource SelectedBrushConverter}">
                    <Binding RelativeSource="{RelativeSource AncestorType=local:LanguageSelectOverlay}" Path="SelectedCode"/>
                    <Binding Path="Code"/>
                    <Binding Source="#22888888"/>
                  </MultiBinding>
                </Border.Background>
                <Button Width="120" Height="100" Background="Transparent" BorderBrush="Transparent" Command="{Binding $parent[local:LanguageSelectOverlay].SelectLanguageCommand}" CommandParameter="{Binding}">
                  <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Border CornerRadius="8" Height="57" Width="95" Background="#282828" ClipToBounds="True">
                      <Svg Path="{Binding IconPath}" Width="110" Height="70"/>
                    </Border>
                                    <TextBlock Text="{Binding Name}" FontSize="{DynamicResource FontSize.Body.Small}" FontWeight="SemiBold" Margin="8,6,8,0" HorizontalAlignment="Center"/>
                <TextBlock Text="{Binding Code}" Opacity="0.7" FontSize="{DynamicResource FontSize.Caption}" HorizontalAlignment="Center"/>
                  </StackPanel>
                </Button>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>

      <!-- Bottom-->
      <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="12" HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,12,0,0">
        <cmp:Paginator x:Name="PaginatorControl"
                       CurrentPage="{Binding CurrentPageDisplay}"
                       TotalPages="{Binding TotalPagesDisplay}"
                       PageChangedCommand="{Binding PageChangedCommand}"/>
        <Button Content="Apply" Command="{Binding ConfirmCommand}" Margin="8,0,0,0"/>
      </StackPanel>
    </Grid>
  </Border>
</UserControl>


