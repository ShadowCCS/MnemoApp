<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:services="using:MnemoApp.Core.Services"
             x:DataType="services:TopbarButtonModel"
             x:Class="MnemoApp.UI.Components.TopbarButton">
  
  <UserControl.Resources>
    <ControlTheme x:Key="TopbarButtonTheme" TargetType="Button">
      <Setter Property="Background" Value="{DynamicResource TopbarButtonBackgroundBrush}" />
      <Setter Property="Foreground" Value="{DynamicResource TopbarButtonForegroundBrush}" />
      <Setter Property="BorderBrush" Value="Transparent" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="CornerRadius" Value="{DynamicResource ButtonCornerRadius}" />
      <Setter Property="Padding" Value="6" />
      <Setter Property="HorizontalAlignment" Value="Left" />
      <Setter Property="VerticalAlignment" Value="Center" />
      
      <!-- Combined transitions for smoother animations -->
      <Setter Property="RenderTransform" Value="none" />
      <Setter Property="RenderTransformOrigin" Value="0.5,0.5" />
      <Setter Property="Transitions">
        <Transitions>
          <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.075" />
          <BrushTransition Property="Background" Duration="0:0:0.075" />
        </Transitions>
      </Setter>

      <Setter Property="Template">
        <ControlTemplate>
          <Grid x:Name="PART_ContentGrid" x:DataType="services:TopbarButtonModel">
            <!-- Button background -->
            <Border Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    CornerRadius="{TemplateBinding CornerRadius}"
                    Cursor="Hand"
                    Padding="{TemplateBinding Padding}">
              <services:MnemoSvg SvgPath="{Binding IconPath}"
                                Width="22" Height="22"
                                StrokeWidth="2.5"
                                Stroke="{DynamicResource IconsTopbarBrush}"
                                VerticalAlignment="Center" 
                                HorizontalAlignment="Center"/>
            </Border>
            <Ellipse Width="6" Height="6" 
                      Fill="{DynamicResource SystemInfoBackgroundBrush}"
                     HorizontalAlignment="Right" 
                     VerticalAlignment="Top"
                     Margin="0,3,3,0"
                      IsVisible="{Binding Notification}"/>
          </Grid>
        </ControlTemplate>
      </Setter>

      <!-- Hover state -->
      <Style Selector="^:pointerover">
        <Setter Property="Background" Value="{DynamicResource TopbarButtonBackgroundHoverBrush}" />
        <Setter Property="RenderTransform" Value="scale(1.06)" />
      </Style>

      <!-- Pressed state -->
      <Style Selector="^:pressed">
        <Setter Property="Background" Value="{DynamicResource TopbarButtonBackgroundPressedBrush}" />
        <Setter Property="RenderTransform" Value="scale(0.98)" />
      </Style>

      <!-- Disabled state -->
      <Style Selector="^:disabled /template/ Border">
        <Setter Property="Opacity" Value="0.5" />
      </Style>
    </ControlTheme>
  </UserControl.Resources>

  <!-- Simplified root - just the button with theme -->
  <Button Theme="{StaticResource TopbarButtonTheme}"
          Command="{Binding Command}"
          ToolTip.Tip="{Binding ToolTip}" />
  
</UserControl>