<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Mnemo.UI.Modules.Settings.ViewModels"
             xmlns:components="using:Mnemo.UI.Components"
             xmlns:controls="using:Mnemo.UI.Controls"
             xmlns:converters="using:Mnemo.UI.Converters"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
             x:Class="Mnemo.UI.Modules.Settings.Views.SettingsView"
             x:DataType="vm:SettingsViewModel">

    <UserControl.Styles>
        <Style Selector="TextBox.SettingsSearch">
            <Setter Property="Background" Value="{DynamicResource CardBackgroundSecondaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="8,0"/>
            <Style Selector="^:pointerover /template/ Border#PART_BorderElement">
                <Setter Property="Background" Value="{DynamicResource ListItemHoverBackgroundBrush}"/>
            </Style>
            <Style Selector="^:focus /template/ Border#PART_BorderElement">
                <Setter Property="Background" Value="{DynamicResource CardBackgroundSecondaryBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="BorderBrush" Value="{DynamicResource CardAccentBrush}"/>
            </Style>
        </Style>
    </UserControl.Styles>

    <UserControl.Resources>
        <converters:PathToImageConverter x:Key="PathToImageConverter"/>
        <converters:BoolToPasswordCharConverter x:Key="BoolToPasswordCharConverter"/>
        <!-- Toggle Setting Template -->
        <DataTemplate x:Key="ToggleSettingTemplate" x:DataType="vm:ToggleSettingViewModel">
            <components:SettingsCard Title="{Binding Title}" Description="{Binding Description}" Margin="0,0,0,8">
                <components:SettingsCard.RightContent>
                    <ToggleSwitch IsChecked="{Binding Value}" 
                                  OnContent="" 
                                  OffContent=""
                                  MinWidth="0"/>
                </components:SettingsCard.RightContent>
            </components:SettingsCard>
        </DataTemplate>

        <!-- Dropdown Setting Template -->
        <DataTemplate x:Key="DropdownSettingTemplate" x:DataType="vm:DropdownSettingViewModel">
            <components:SettingsCard Title="{Binding Title}" Description="{Binding Description}" Margin="0,0,0,8">
                <components:SettingsCard.RightContent>
                    <controls:ModernComboBox ItemsSource="{Binding Options}" 
                              SelectedItem="{Binding SelectedOption}" 
                              Width="180"
                              Height="36"
                              VerticalContentAlignment="Center"/>
                </components:SettingsCard.RightContent>
            </components:SettingsCard>
        </DataTemplate>

        <!-- Action Setting Template -->
        <DataTemplate x:Key="ActionSettingTemplate" x:DataType="vm:ActionSettingViewModel">
            <components:SettingsCard Title="{Binding Title}" Description="{Binding Description}" Margin="0,0,0,8">
                <components:SettingsCard.RightContent>
                    <Button Content="{Binding ActionText}" 
                            Padding="16,8"
                            CornerRadius="6"
                            Background="{DynamicResource SecondaryButtonBackgroundBrush}"
                            Foreground="{DynamicResource SecondaryButtonTextColorBrush}"
                            BorderThickness="0"
                            FontSize="13"
                            FontFamily="{DynamicResource Font.Medium}">
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background" Value="{DynamicResource ListItemHoverBackgroundBrush}"/>
                            </Style>
                            <Style Selector="Button:pressed">
                                <Setter Property="Background" Value="{DynamicResource ListItemActiveBackgroundBrush}"/>
                            </Style>
                        </Button.Styles>
                    </Button>
                </components:SettingsCard.RightContent>
            </components:SettingsCard>
        </DataTemplate>

        <!-- App Icon Setting Template -->
        <DataTemplate x:Key="AppIconSettingTemplate" x:DataType="vm:AppIconSettingViewModel">
            <components:SettingsCard Title="{Binding Title}" Description="{Binding Description}" Margin="0,0,0,8">
                <components:SettingsCard.RightContent>
                    <ItemsControl ItemsSource="{Binding Options}" ClipToBounds="False">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="8" ClipToBounds="False" Margin="4"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="vm:AppIconOptionViewModel">
                                <Button Command="{Binding SelectCommand}" 
                                        Padding="0" 
                                        Background="Transparent" 
                                        BorderThickness="0"
                                        Cursor="Hand">
                                    <Button.Styles>
                                        <Style Selector="Button">
                                            <Setter Property="Transitions">
                                                <Transitions>
                                                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.1"/>
                                                </Transitions>
                                            </Setter>
                                        </Style>
                                        <Style Selector="Button:pointerover">
                                            <Setter Property="RenderTransform" Value="scale(1.1)"/>
                                        </Style>
                                        <Style Selector="Button:pointerover /template/ ContentPresenter#PART_ContentPresenter">
                                            <Setter Property="Background" Value="Transparent"/>
                                        </Style>
                                    </Button.Styles>
                                    <Border Width="42" Height="42" 
                                            CornerRadius="8" 
                                            ClipToBounds="True"
                                            BorderThickness="2"
                                            Background="{DynamicResource CardBackgroundSecondaryBrush}"
                                            Classes.selected="{Binding IsSelected}">
                                        <Border.Styles>
                                            <Style Selector="Border">
                                                <Setter Property="BorderBrush" Value="Transparent"/>
                                                <Setter Property="Transitions">
                                                    <Transitions>
                                                        <BrushTransition Property="BorderBrush" Duration="0:0:0.2"/>
                                                    </Transitions>
                                                </Setter>
                                            </Style>
                                            <Style Selector="Border:pointerover">
                                                <Setter Property="BorderBrush" Value="{DynamicResource CardAccentBrush}"/>
                                            </Style>
                                            <Style Selector="Border.selected">
                                                <Setter Property="BorderBrush" Value="{DynamicResource CardAccentBrush}"/>
                                            </Style>
                                        </Border.Styles>
                                        <Image Source="{Binding IconPath, Converter={StaticResource PathToImageConverter}}" 
                                               Width="32" Height="32"
                                               Margin="4"
                                               Stretch="Uniform"/>
                                    </Border>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </components:SettingsCard.RightContent>
            </components:SettingsCard>
        </DataTemplate>

        <!-- Profile Picture Setting Template -->
        <DataTemplate x:Key="ProfilePictureSettingTemplate" x:DataType="vm:ProfilePictureSettingViewModel">
            <components:SettingsCard Title="{Binding Title}" Description="{Binding Description}" Margin="0,0,0,8">
                <components:SettingsCard.RightContent>
                    <ItemsControl ItemsSource="{Binding Options}" ClipToBounds="False">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="8" ClipToBounds="False" Margin="4"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="vm:ProfilePictureOptionViewModel">
                                <Button Command="{Binding SelectCommand}" 
                                        Padding="0" 
                                        Background="Transparent" 
                                        BorderThickness="0"
                                        Cursor="Hand">
                                    <Button.Styles>
                                        <Style Selector="Button">
                                            <Setter Property="Transitions">
                                                <Transitions>
                                                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.1"/>
                                                </Transitions>
                                            </Setter>
                                        </Style>
                                        <Style Selector="Button:pointerover">
                                            <Setter Property="RenderTransform" Value="scale(1.1)"/>
                                        </Style>
                                        <Style Selector="Button:pointerover /template/ ContentPresenter#PART_ContentPresenter">
                                            <Setter Property="Background" Value="Transparent"/>
                                        </Style>
                                    </Button.Styles>
                                    <Border Width="42" Height="42" 
                                            CornerRadius="21" 
                                            ClipToBounds="True"
                                            BorderThickness="2"
                                            Background="{DynamicResource CardBackgroundSecondaryBrush}"
                                            Classes.selected="{Binding IsSelected}">
                                        <Border.Styles>
                                            <Style Selector="Border">
                                                <Setter Property="BorderBrush" Value="Transparent"/>
                                                <Setter Property="Transitions">
                                                    <Transitions>
                                                        <BrushTransition Property="BorderBrush" Duration="0:0:0.2"/>
                                                    </Transitions>
                                                </Setter>
                                            </Style>
                                            <Style Selector="Border:pointerover">
                                                <Setter Property="BorderBrush" Value="{DynamicResource CardAccentBrush}"/>
                                            </Style>
                                            <Style Selector="Border.selected">
                                                <Setter Property="BorderBrush" Value="{DynamicResource CardAccentBrush}"/>
                                            </Style>
                                        </Border.Styles>
                                        <Image Source="{Binding ImagePath, Converter={StaticResource PathToImageConverter}}" Stretch="UniformToFill"/>
                                    </Border>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </components:SettingsCard.RightContent>
            </components:SettingsCard>
        </DataTemplate>

        <!-- Name Setting Template -->
        <DataTemplate x:Key="NameSettingTemplate" x:DataType="vm:NameSettingViewModel">
            <components:SettingsCard Title="{Binding Title}" Description="{Binding Description}" Margin="0,0,0,8">
                <components:SettingsCard.RightContent>
                    <TextBox Text="{Binding UserName}" 
                             FontSize="14" 
                             FontFamily="{DynamicResource Font.Medium}"
                             Background="{DynamicResource CardBackgroundSecondaryBrush}"
                             BorderThickness="0"
                             CornerRadius="8"
                             Padding="12,8"
                             Width="250"
                             VerticalContentAlignment="Center">
                        <TextBox.Styles>
                            <Style Selector="TextBox:focus /template/ Border#PART_BorderElement">
                                <Setter Property="Background" Value="{DynamicResource CardBackgroundSecondaryBrush}"/>
                                <Setter Property="BorderThickness" Value="1"/>
                                <Setter Property="BorderBrush" Value="{DynamicResource CardAccentBrush}"/>
                            </Style>
                        </TextBox.Styles>
                    </TextBox>
                </components:SettingsCard.RightContent>
            </components:SettingsCard>
        </DataTemplate>

        <!-- Text Setting Template -->
        <DataTemplate x:Key="TextSettingTemplate" x:DataType="vm:TextSettingViewModel">
            <components:SettingsCard Title="{Binding Title}" Description="{Binding Description}" Margin="0,0,0,8">
                <components:SettingsCard.RightContent>
                    <TextBox Text="{Binding Value}" 
                             FontSize="14" 
                             FontFamily="{DynamicResource Font.Medium}"
                             Background="{DynamicResource CardBackgroundSecondaryBrush}"
                             BorderThickness="0"
                             CornerRadius="8"
                             Padding="12,8"
                             Width="250"
                             VerticalContentAlignment="Center"
                             PasswordChar="{Binding IsPassword, Converter={StaticResource BoolToPasswordCharConverter}}">
                        <TextBox.Styles>
                            <Style Selector="TextBox:focus /template/ Border#PART_BorderElement">
                                <Setter Property="Background" Value="{DynamicResource CardBackgroundSecondaryBrush}"/>
                                <Setter Property="BorderThickness" Value="1"/>
                                <Setter Property="BorderBrush" Value="{DynamicResource CardAccentBrush}"/>
                            </Style>
                        </TextBox.Styles>
                    </TextBox>
                </components:SettingsCard.RightContent>
            </components:SettingsCard>
        </DataTemplate>

    </UserControl.Resources>

    <Grid ColumnDefinitions="300,*">
        <!-- Settings Sidebar -->
        <Border Grid.Column="0" 
                Background="{DynamicResource SidebarBackgroundBrush}" 
                BorderBrush="{DynamicResource SidebarBorderBrush}" 
                BorderThickness="0,0,1,0">
            <Grid RowDefinitions="Auto,Auto,Auto,*">
                <!-- Sidebar Header/Profile -->
                <Border Grid.Row="0" Padding="24,32,24,16">
                    <StackPanel Spacing="16">
                        <TextBlock Text="Settings" 
                                   FontSize="24" 
                                   FontFamily="{DynamicResource Font.Bold}" 
                                   Foreground="{DynamicResource TextPrimaryBrush}"/>
                        
                        <Border Background="{DynamicResource CardBackgroundSecondaryBrush}"
                                CornerRadius="12"
                                Padding="12">
                            <Grid ColumnDefinitions="Auto,*,Auto">
                                <Border Grid.Column="0" Width="40" Height="40" CornerRadius="20" ClipToBounds="True">
                                    <Image Source="{Binding ProfilePicturePath, Converter={StaticResource PathToImageConverter}}" Stretch="UniformToFill"/>
                                </Border>
                                <StackPanel Grid.Column="1" Margin="12,0" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding UserName}" 
                                               FontSize="14" 
                                               FontFamily="{DynamicResource Font.SemiBold}"
                                               Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    <TextBlock Text="Welcome to Mnemo" 
                                               FontSize="12" 
                                               Foreground="{DynamicResource TextSecondaryBrush}"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </StackPanel>
                </Border>

                <!-- Search Bar -->
                <Border Grid.Row="1" Padding="24,0,24,24">
                    <TextBox Watermark="Search settings..."
                             Classes="SettingsSearch"
                             Height="38"
                             VerticalContentAlignment="Center">
                        <TextBox.InnerLeftContent>
                            <controls:SvgIcon SvgPath="avares://Mnemo.UI/Icons/Tabler/Used/Outlined/search.svg" 
                                              Width="16" Height="16" 
                                              Margin="12,0,0,0"
                                              Color="{DynamicResource TextSecondaryBrush}"/>
                        </TextBox.InnerLeftContent>
                    </TextBox>
                </Border>

                <Separator Grid.Row="2" Height="1" Background="{DynamicResource SidebarBorderBrush}" Margin="24,0,24,16" Opacity="0.5"/>
                
                <ScrollViewer Grid.Row="3">
                    <Border Padding="12,0,12,24">
                        <ItemsControl ItemsSource="{Binding Categories}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:SettingsCategoryViewModel">
                                    <controls:NavigationButton IsSelected="{Binding IsSelected}"
                                                               Command="{Binding $parent[UserControl].((vm:SettingsViewModel)DataContext).SelectCategoryCommand}"
                                                               CommandParameter="{Binding}"
                                                               HorizontalAlignment="Stretch"
                                                               Margin="12,0,12,4"
                                                               Padding="12,10"
                                                               CornerRadius="8">
                                        <StackPanel Orientation="Horizontal" Spacing="12">
                                            <controls:SvgIcon SvgPath="{Binding Icon}" 
                                                              Width="18" Height="18"/>
                                            <TextBlock Text="{Binding Name}" 
                                                       VerticalAlignment="Center"
                                                       FontSize="14"
                                                       FontFamily="{DynamicResource Font.Medium}"/>
                                        </StackPanel>
                                    </controls:NavigationButton>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Border>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Settings Content Area -->
        <Border Grid.Column="1" Background="{DynamicResource WorkspaceBackgroundBrush}">
            <ScrollViewer>
                <Border Padding="48,32,48,64">
                    <StackPanel Spacing="40" MaxWidth="800" HorizontalAlignment="Left">
                        <!-- Category Header -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="{Binding SelectedCategory.Name}" 
                                       FontSize="32" 
                                       FontFamily="{DynamicResource Font.Bold}" 
                                       Foreground="{DynamicResource TextPrimaryBrush}"/>
                            <TextBlock Text="Manage your preferences and application settings."
                                       FontSize="14"
                                       Foreground="{DynamicResource TextSecondaryBrush}"/>
                        </StackPanel>

                        <Separator Height="1" Background="{DynamicResource SidebarBorderBrush}" Opacity="0.3"/>

                        <!-- Settings Groups -->
                        <ItemsControl ItemsSource="{Binding SelectedCategory.Groups}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:SettingsGroupViewModel">
                                    <StackPanel Spacing="12" Margin="0,0,0,40">
                                        <TextBlock Text="{Binding Name}" 
                                                   FontSize="12" 
                                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                                   FontFamily="{DynamicResource Font.SemiBold}"
                                                   LetterSpacing="0.5"
                                                   Margin="0,0,0,8"/>
                                        
                                        <ItemsControl ItemsSource="{Binding Items}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <ContentControl Content="{Binding}">
                                                        <ContentControl.DataTemplates>
                                                            <StaticResource ResourceKey="ToggleSettingTemplate"/>
                                                            <StaticResource ResourceKey="DropdownSettingTemplate"/>
                                                            <StaticResource ResourceKey="ActionSettingTemplate"/>
                                                            <StaticResource ResourceKey="AppIconSettingTemplate"/>
                                                            <StaticResource ResourceKey="ProfilePictureSettingTemplate"/>
                                                            <StaticResource ResourceKey="NameSettingTemplate"/>
                                                            <StaticResource ResourceKey="TextSettingTemplate"/>
                                                        </ContentControl.DataTemplates>
                                                    </ContentControl>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>
